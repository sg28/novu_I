import { expect, describe, it } from 'vitest';
import { buildWorkflowPreferences } from './buildWorkflowPreferences';
const WORKFLOW_CHANNEL_PREFERENCE_DEFAULT_VALUE = true;
const WORKFLOW_CHANNEL_PREFERENCE_DEFAULT_READ_ONLY = false;
const DEFAULT_WORKFLOW_PREFERENCE = {
    enabled: WORKFLOW_CHANNEL_PREFERENCE_DEFAULT_VALUE,
    readOnly: WORKFLOW_CHANNEL_PREFERENCE_DEFAULT_READ_ONLY,
};
const DEFAULT_CHANNEL_PREFERENCE = {
    enabled: WORKFLOW_CHANNEL_PREFERENCE_DEFAULT_VALUE,
};
const testDefaultPreferences = {
    all: DEFAULT_WORKFLOW_PREFERENCE,
    channels: {
        in_app: DEFAULT_CHANNEL_PREFERENCE,
        sms: DEFAULT_CHANNEL_PREFERENCE,
        email: DEFAULT_CHANNEL_PREFERENCE,
        push: DEFAULT_CHANNEL_PREFERENCE,
        chat: DEFAULT_CHANNEL_PREFERENCE,
    },
};
describe('buildWorkflowPreferences', () => {
    it('should return the defaults if input is undefined', () => {
        const result = buildWorkflowPreferences(undefined, testDefaultPreferences);
        expect(result).toEqual(testDefaultPreferences);
    });
    it('should return the input object if a complete preferences object is supplied', () => {
        const testWorkflowPreference = {
            enabled: false,
            readOnly: true,
        };
        const testChannelPreference = {
            enabled: false,
        };
        const testPreferences = {
            all: testWorkflowPreference,
            channels: {
                in_app: testChannelPreference,
                sms: testChannelPreference,
                email: testChannelPreference,
                push: testChannelPreference,
                chat: testChannelPreference,
            },
        };
        const result = buildWorkflowPreferences(testPreferences, testDefaultPreferences);
        expect(result).toEqual(testPreferences);
    });
    describe('should populate the remainder of the object with default values', () => {
        it('using just a full, single channel', () => {
            const testPreferences = {
                channels: { in_app: { enabled: false } },
            };
            const result = buildWorkflowPreferences(testPreferences, testDefaultPreferences);
            expect(result).toEqual(Object.assign(Object.assign({}, testDefaultPreferences), { channels: Object.assign(Object.assign({}, testDefaultPreferences.channels), { in_app: { enabled: false } }) }));
        });
        it('using a combination of channels and workflow-level preferences', () => {
            var _a, _b, _c;
            const testPreferences = {
                all: { enabled: true, readOnly: true },
                channels: {
                    in_app: { enabled: false },
                    chat: { enabled: false },
                },
            };
            const result = buildWorkflowPreferences(testPreferences, testDefaultPreferences);
            expect(result).toEqual({
                all: testPreferences.all,
                channels: {
                    in_app: {
                        enabled: false,
                    },
                    chat: {
                        enabled: false,
                    },
                    sms: {
                        enabled: (_a = testPreferences.all) === null || _a === void 0 ? void 0 : _a.enabled,
                    },
                    email: {
                        enabled: (_b = testPreferences.all) === null || _b === void 0 ? void 0 : _b.enabled,
                    },
                    push: {
                        enabled: (_c = testPreferences.all) === null || _c === void 0 ? void 0 : _c.enabled,
                    },
                },
            });
        });
    });
    it('should use the `workflow`-level preferences to define defaults for all channel-level preferences', () => {
        const expectedDefaultValue = false;
        const testPreferences = {
            all: { enabled: expectedDefaultValue },
        };
        const result = buildWorkflowPreferences(testPreferences, testDefaultPreferences);
        const expectedResult = {
            all: {
                enabled: expectedDefaultValue,
                readOnly: WORKFLOW_CHANNEL_PREFERENCE_DEFAULT_READ_ONLY,
            },
            channels: {
                in_app: {
                    enabled: expectedDefaultValue,
                },
                sms: {
                    enabled: expectedDefaultValue,
                },
                email: {
                    enabled: expectedDefaultValue,
                },
                push: {
                    enabled: expectedDefaultValue,
                },
                chat: {
                    enabled: expectedDefaultValue,
                },
            },
        };
        expect(result).toEqual(expectedResult);
    });
});
